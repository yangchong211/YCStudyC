# C 语言基本语法

## 语句

C 语言的代码由一行行语句（statement）组成。语句就是程序执行的一个操作命令。C 语言规定，语句必须使用分号结尾，除非有明确规定可以不写分号。

```c
int x = 1;
```

上面就是一个变量声明语句，声明整数变量`x`，并且将值设为`1`。

多个语句可以写在一行。

```c
int x; x = 1;
```

上面示例是两个语句写在一行。所以，语句之间的换行符并不是必需的，只是为了方便阅读代码。

一个语句也可以写成多行，这时就要依靠分号判断语句在哪一行结束。

```c
int x;
x
=
1
;
```

上面示例中，第二个语句`x = 1;`被拆成了四行。编译器会自动忽略代码里面的换行。

单个分号也是有效语句，称为“空语句”，虽然毫无作用。

```c
;
```

## 表达式

C 语言的各种计算，主要通过表达式完成。表达式（expression）是一个计算式，用来获取值。

```c
1 + 2
```

上面代码就是一个表达式，用来获取`1 + 2`这个算术计算的结果。

表达式加上分号，也可以成为语句，但是没有实际的作用。

```c
8;
3 + 4;
```

上面示例是两个表达式，加上分号以后成为语句。

表达式与语句的区别主要是两点：

- 语句可以包含表达式，但是表达式本身不构成语句。
- 表达式都有返回值，语句不一定有。因为语句用来执行某个命令，很多时候不需要返回值，比如变量声明语句（`int x = 1`）就没有返回值。

## 语句块

C 语言允许多个语句使用一对大括号`{}`，组成一个块，也称为复合语句（compounded statement）。在语法上，语句块可以视为多个语句组成的一个复合语句。

```c
{
  int x;
  x = 1;
}
```

上面示例中，大括号形成了一个语句块。

大括号的结尾不需要添加分号。

## 空格

C 语言里面的空格，主要用来帮助编译器区分语法单位。如果语法单位不用空格就能区分，空格就不是必须的，只是为了增加代码的可读性。

```c
int x = 1;
// 等同于
int x=1;
```

上面示例中，赋值号（`=`）前后有没有空格都可以，因为编译器这里不借助空格，就能区分语法单位。

语法单位之间的多个空格，等同于单个空格。

```c
int    x =     1;
```

上面示例中，各个语法单位之间的多个空格，跟单个空格的效果是一样的。

空格还用来表示缩进。多层级的代码有没有缩进，其实对于编译器来说并没有差别，没有缩进的代码也是完全可以运行的。强调代码缩进，只是为了增强代码可读性，便于区分代码块。

大多数 C 语言的风格要求是，下一级代码比上一级缩进4个空格。为了书写的紧凑，本书采用缩写两个空格。

```c
// 缩进四个空格
if (x > 0)
    printf("positive\n");

// 缩进两个空格
if (x > 0)
  printf("positive\n");
```

只包含空格的行被称为空白行，编译器会完全忽略该行。

## 注释

注释是对代码的说明，编译器会忽略注释，也就是说，注释对实际代码没有影响。

C 语言的注释有两种表示方法。第一种方法是将注释放在`/*...*/`之间，内部可以分行。

```c
/* 注释 */

/*
  这是一行注释
*/
```

这种注释可以插在行内。

```c
int open(char* s /* file name */, int mode);
```

上面示例中，`/* file name */`用来对函数参数进行说明，跟在它后面的代码依然会有效执行。

这种注释一定不能忘记写结束符号`*/`，否则很容易导致错误。

```c
printf("a "); /* 注释一
printf("b ");
printf("c "); /* 注释二 */
printf("d ");
```

上面示例的原意是，第一行和第三行代码的尾部，有两个注释。但是，第一行注释忘记写结束符号，导致注释一延续到第三行结束。

第二种写法是将注释放在双斜杠`//`后面，从双斜杠到行尾都属于注释。这种注释只能是单行，可以放在行首，也可以放在一行语句的结尾。这是 C99 标准新增的语法。

```c
// 这是一行注释

int x = 1; // 这也是注释
```

不管是哪一种注释，都不能放在双引号里面。双引号里面的注释符号，会成为字符串的一部分，解释为普通符号，失去注释作用。

```c
printf("// hello /* world */ ");
```

上面示例中，双引号里面的注释符号，都会被视为普通字符，没有注释作用。

编译时，注释会被替换成一个空格，所以`min/* space */Value`会变成`min Value`，而不是`minValue`。

## printf()

### 基本用法

本书的示例会大量用到`printf()`函数，这里先介绍一下这个函数。

`printf()`的作用是将参数文本输出到屏幕。它名字里面的`f`代表`format`（格式化），表示可以定制输出文本的格式。

```c
printf("Hello World");
```

上面命令会在屏幕上输出一行文字“Hello World”。

`printf()`不会在行尾自动添加换行符，运行结束后，光标就停留在输出结束的地方，不会自动换行。为了让光标移到下一行的开头，可以在输出文本的结尾，添加一个换行符`\n`。

```c
printf("Hello World\n");
```

如果文本内部有换行，也是通过插入换行符来实现。

```c
printf("Hello\nWorld\n");
```

上面示例先输出一个`Hello`，然后换行，在下一行开头输出`World`，然后又是一个换行。

上面示例也可以写成两个`printf()`，效果完全一样。

```c
printf("Hello\n");
printf("World\n");
```

`printf()`是在标准库的头文件`stdio.h`定义的。使用这个函数之前，必须在源码文件头部引入这个头文件。

```c
#include <stdio.h>

int main(void) {
  printf("Hello World\n");
}
```

上面示例中，只有在源码头部加上`#include <stdio.h>`，才能使用`printf()`这个函数。`#include`指令的详细解释，请看《预处理器》一章。

### 占位符

`printf()`可以在输出文本中指定占位符。所谓“占位符”，就是这个位置可以用其他值代入。

```c
// 输出 There are 3 apples
printf("There are %i apples\n", 3);
```

上面示例中，`There are %i apples\n`是输出文本，里面的`%i`就是占位符，表示这个位置要用其他值来替换。占位符的第一个字符一律为百分号`%`，第二个字符表示占位符的类型，`%i`表示这里代入的值必须是一个整数。

`printf()`的第二个参数就是替换占位符的值，上面的例子是整数`3`替换`%i`。执行后的输出结果就是`There are 3 apples`。

常用的占位符除了`%i`，还有`%s`表示代入的是字符串。

```c
printf("%s will come tonight\n", "Jane");
```

上面示例中，`%s`表示代入的是一个字符串，所以`printf()`的第二个参数就必须是字符串，这个例子是`Jane`。执行后的输出就是`Jane will come tonight`。

输出文本里面可以使用多个占位符。

```c
printf("%s says it is %i o'clock\n", "Ben", 21);
```

上面示例中，输出文本`%s says it is %i o'clock`有两个占位符，第一个是字符串占位符`%s`，第二个是整数占位符`%i`，分别对应`printf()`的第二个参数（`Ben`）和第三个参数（`21`）。执行后的输出就是`Ben says it is 21 o'clock`。

`printf()`参数与占位符是一一对应关系，如果有`n`个占位符，`printf()`的参数就应该有`n + 1`个。如果参数个数少于对应的占位符，`printf()`可能会输出内存中的任意值。

`printf()`的占位符有许多种类，与 C 语言的数据类型相对应。下面按照字母顺序，列出常用的占位符，方便查找，具体含义在后面章节介绍。

- `%a`：十六进制浮点数，字母输出为小写。
- `%A`：十六进制浮点数，字母输出为大写。
- `%c`：字符。
- `%d`：十进制整数。
- `%e`：使用科学计数法的浮点数，指数部分的`e`为小写。
- `%E`：使用科学计数法的浮点数，指数部分的`E`为大写。
- `%i`：整数，基本等同于`%d`。
- `%f`：小数（包含`float`类型和`double`类型）。
- `%g`：6个有效数字的浮点数。整数部分一旦超过6位，就会自动转为科学计数法，指数部分的`e`为小写。
- `%G`：等同于`%g`，唯一的区别是指数部分的`E`为大写。
- `%hd`：十进制 short int 类型。
- `%ho`：八进制 short int 类型。
- `%hx`：十六进制 short int 类型。
- `%hu`：unsigned short int 类型。
- `%ld`：十进制 long int 类型。
- `%lo`：八进制 long int 类型。
- `%lx`：十六进制 long int 类型。
- `%lu`：unsigned long int 类型。
- `%lld`：十进制 long long int 类型。
- `%llo`：八进制 long long int 类型。
- `%llx`：十六进制 long long int 类型。
- `%llu`：unsigned long long int 类型。
- `%Le`：科学计数法表示的 long double 类型浮点数。
- `%Lf`：long double 类型浮点数。
- `%n`：已输出的字符串数量。该占位符本身不输出，只将值存储在指定变量之中。
- `%o`：八进制整数。
- `%p`：指针。
- `%s`：字符串。
- `%u`：无符号整数（unsigned int）。
- `%x`：十六进制整数。
- `%zd`：`size_t`类型。
- `%%`：输出一个百分号。

### 输出格式

`printf()`可以定制占位符的输出格式。

（1）限定宽度

`printf()`允许限定占位符的最小宽度。

```c
printf("%5d\n", 123); // 输出为 "  123"
```

上面示例中，`%5d`表示这个占位符的宽度至少为5位。如果不满5位，对应的值的前面会添加空格。

输出的值默认是右对齐，即输出内容前面会有空格；如果希望改成左对齐，在输出内容后面添加空格，可以在占位符的`%`的后面插入一个`-`号。

```c
printf("%-5d\n", 123); // 输出为 "123  "
```

上面示例中，输出内容`123`的后面添加了空格。

对于小数，这个限定符会限制所有数字的最小显示宽度。

```c
// 输出 "  123.450000"
printf("%12f\n", 123.45);
```

上面示例中，`%12f`表示输出的浮点数最少要占据12位。由于小数的默认显示精度是小数点后6位，所以`123.45`输出结果的头部会添加2个空格。

（2）总是显示正负号

默认情况下，`printf()`不对正数显示`+`号，只对负数显示`-`号。如果想让正数也输出`+`号，可以在占位符的`%`后面加一个`+`。

```c
printf("%+d\n", 12); // 输出 +12
printf("%+d\n", -12); // 输出 -12
```

上面示例中，`%+d`可以确保输出的数值，总是带有正负号。

（3）限定小数位数

输出小数时，有时希望限定小数的位数。举例来说，希望小数点后面只保留两位，占位符可以写成`%.2f`。

```c
// 输出 Number is 0.50
printf("Number is %.2f\n", 0.5);
```

上面示例中，如果希望小数点后面输出3位（`0.500`），占位符就要写成`%.3f`。

这种写法可以与限定宽度占位符，结合使用。

```c
// 输出为 "  0.50"
printf("%6.2f\n", 0.5);
```

上面示例中，`%6.2f`表示输出字符串最小宽度为6，小数位数为2。所以，输出字符串的头部有两个空格。

最小宽度和小数位数这两个限定值，都可以用`*`代替，通过`printf()`的参数传入。

```c
printf("%*.*f\n", 6, 2, 0.5);

// 等同于
printf("%6.2f\n", 0.5);
```

上面示例中，`%*.*f`的两个星号通过`printf()`的两个参数`6`和`2`传入。

（4）输出部分字符串

`%s`占位符用来输出字符串，默认是全部输出。如果只想输出开头的部分，可以用`%.[m]s`指定输出的长度，其中`[m]`代表一个数字，表示所要输出的长度。

```c
// 输出 hello
printf("%.5s\n", "hello world");
```

上面示例中，占位符`%.5s`表示只输出字符串“hello world”的前5个字符，即“hello”。

## 标准库，头文件

程序需要用到的功能，不一定需要自己编写，C 语言可能已经自带了。程序员只要去调用这些自带的功能，就省得自己编写代码了。举例来说，`printf()`这个函数就是 C 语言自带的，只要去调用它，就能实现在屏幕上输出内容。

C 语言自带的所有这些功能，统称为“标准库”（standard library），因为它们是写入标准的，到底包括哪些功能，应该怎么使用的，都是规定好的，这样才能保证代码的规范和可移植。

不同的功能定义在不同的文件里面，这些文件统称为“头文件”（header file）。如果系统自带某一个功能，就一定还会自带描述这个功能的头文件，比如`printf()`的头文件就是系统自带的`stdio.h`。头文件的后缀通常是`.h`。

如果要使用某个功能，就必须先加载对应的头文件，加载使用的是`#include`命令。这就是为什么使用`printf()`之前，必须先加载`stdio.h`的原因。

```c
#include <stdio.h>
```

注意，加载头文件的`#include`语句不需要分号结尾，详见《预处理器》一章。

